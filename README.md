# doooocker

## 实现思路

目的大概是利用namespace实现一个类似docker一样的各种隔离的容器

1. 文件隔离

为了使普通用户能在容器里假装自己是root，就要使用chroot给用户一个空头root。还要准备独立的文件让他自己玩耍，这里在实现之前我准备了一个基础的环境

```sh
proc lib bin usr
```

bin 里有一些基础程序 lib里有基础的运行库

设施一定要齐全，要不然会报找不到命令的错误（此处踩坑）

接下来使用mount()来进行一些内核的资源调用

毕竟中心思想就是共享内核资源嘛

2. 进程隔离

目的是使容器内ps top之类的命令看不到外界的进程，同时对其他容器不可见，也就是一个独立的进程树，通俗讲就是使pid为根1.

这里好像使用CLONE_NEWPID的系统调用就ok，配和上面proc的隔离使用。

3. 用户隔离

能够将容器外的普通用户映射为容器内的root用户，这里通过设定映射关系就能实现。

4. 网络隔离

通过网桥的使用加上CLONE_NEWNET来实现这个功能

这里踩了个回环地址的坑


## 其他

端口映射使用宿主机的iptables实现